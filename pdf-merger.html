
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Merger & Splitter - OneKit</title>
  <!-- Libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #1E3CFF, #3B82F6);
      color: #ffffff;
      text-align: center;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      box-sizing: border-box;
    }

    .tool-card {
      background: #ffffff;
      color: #1E1E2F;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    h2 {
      color: #1E3CFF;
      margin-top: 0;
      margin-bottom: 25px;
      font-size: 2rem;
    }
    
    .switch-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 25px;
      background-color: #f0f4ff;
      border-radius: 50px;
      padding: 5px;
      user-select: none;
    }

    .switch-label {
      padding: 8px 20px;
      cursor: pointer;
      font-weight: 600;
      color: #5a78fa;
      border-radius: 50px;
      transition: all 0.3s ease-in-out;
      flex: 1;
    }

    .switch-radio {
      display: none;
    }

    .switch-radio:checked + .switch-label {
      background-color: #1E3CFF;
      color: white;
      box-shadow: 0 2px 10px rgba(30, 60, 255, 0.3);
    }

    #upload-box {
      border: 2px dashed #d1d5db;
      border-radius: 12px;
      padding: 40px 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      background-color: #f8fafc;
      margin-bottom: 20px;
    }

    #upload-box:hover {
      border-color: #1E3CFF;
      background-color: #f0f4ff;
    }
    
    #upload-box p {
      margin: 0;
      font-weight: 600;
      color: #334155;
    }

    input[type="file"] {
      display: none;
    }

    /* Merge File List Styles */
    #file-list {
      list-style-type: none;
      padding: 0;
      margin: -10px 0 20px 0;
      text-align: left;
    }
    #file-list li {
      background-color: #f8fafc;
      padding: 10px 15px;
      margin-bottom: 5px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: grab;
    }
    #file-list li:active {
        cursor: grabbing;
    }
    #file-list li.dragging {
      opacity: 0.5;
      background-color: #e0e7ff;
    }
    .drag-handle {
      margin-right: 10px;
      color: #94a3b8;
    }
    
    /* Split Options Styles */
    #split-options {
      text-align: left;
      margin-bottom: 20px;
    }
    #split-options label {
      display: block;
      font-weight: 600;
      color: #4b5563;
      margin-bottom: 8px;
    }
    #split-options input {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    #split-options p {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 8px;
    }

    button {
      padding: 14px 28px;
      background-color: #1E3CFF;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 600;
      transition: all 0.3s ease;
      width: 100%;
    }
    button:hover { background-color: #3B82F6; }
    button:disabled { background-color: #a9b7d0; cursor: not-allowed; }

    #status {
      margin-top: 15px;
      color: #1E3CFF;
      font-weight: bold;
      min-height: 20px;
    }

    a.download-btn {
      display: inline-block;
      background-color: #10B981;
      color: #fff;
      padding: 14px 28px;
      margin-top: 15px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      width: 100%;
      box-sizing: border-box;
    }
    a.download-btn:hover { background-color: #059669; }

    footer {
      margin-top: 30px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .hidden { display: none; }
    .home-link {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      margin-bottom: 20px;
      display: inline-block;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <a href="/" class="home-link">&larr; Back to All Tools</a>
  <div class="tool-card">
    <h2>PDF Merger & Splitter</h2>
    <div class="switch-container">
      <input type="radio" id="mode-merge" name="tool-mode" class="switch-radio" value="merge" checked>
      <label for="mode-merge" class="switch-label">Merge PDFs</label>
      <input type="radio" id="mode-split" name="tool-mode" class="switch-radio" value="split">
      <label for="mode-split" class="switch-label">Split PDF</label>
    </div>
    
    <input type="file" id="fileInput" accept=".pdf,application/pdf" />
    <div id="upload-box" role="button" tabindex="0">
        <p id="upload-text">Click to upload PDFs to merge</p>
    </div>
    
    <!-- Merge Mode UI -->
    <div id="merge-ui">
        <ol id="file-list"></ol>
    </div>

    <!-- Split Mode UI -->
    <div id="split-ui" class="hidden">
        <p id="split-file-name" style="font-style: italic; color: #4b5563; margin-top: -10px; margin-bottom: 15px;"></p>
        <div id="split-options">
            <label for="page-ranges">Pages to Extract</label>
            <input type="text" id="page-ranges" placeholder="e.g., 1-3, 5, 8-10">
            <p>Each range will be saved as a separate PDF in a ZIP file.</p>
        </div>
    </div>

    <button id="actionBtn" disabled>Merge PDFs</button>

    <p id="status" aria-live="polite">Loading required libraries...</p>
    <a id="downloadLink" class="download-btn hidden"></a>
  </div>
  <footer>Made with ðŸ’™ by OneKit</footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- DOM Elements ---
      const modeMergeRadio = document.getElementById('mode-merge');
      const modeSplitRadio = document.getElementById('mode-split');
      const uploadBox = document.getElementById('upload-box');
      const uploadText = document.getElementById('upload-text');
      const fileInput = document.getElementById('fileInput');
      const actionBtn = document.getElementById('actionBtn');
      const status = document.getElementById('status');
      const downloadLink = document.getElementById('downloadLink');
      
      // Mode-specific UI
      const mergeUI = document.getElementById('merge-ui');
      const splitUI = document.getElementById('split-ui');
      const fileList = document.getElementById('file-list');
      const splitFileName = document.getElementById('split-file-name');
      const pageRangesInput = document.getElementById('page-ranges');
      
      let currentMode = 'merge';
      let uploadedFiles = [];

      // --- Library Loading Check ---
      window.addEventListener('load', () => {
          if (window.PDFLib && window.JSZip) {
              status.textContent = '';
          } else {
              status.textContent = 'Error: Failed to load resources. Please refresh.';
              console.error('pdf-lib or jszip failed to load.');
          }
      });
      
      // --- UI Mode Switching ---
      function updateUIForMode(mode) {
        currentMode = mode;
        resetState();
        if (mode === 'merge') {
          mergeUI.classList.remove('hidden');
          splitUI.classList.add('hidden');
          uploadText.textContent = 'Click to upload PDFs to merge';
          actionBtn.textContent = 'Merge PDFs';
          fileInput.multiple = true;
        } else {
          mergeUI.classList.add('hidden');
          splitUI.classList.remove('hidden');
          uploadText.textContent = 'Click to upload a single PDF to split';
          actionBtn.textContent = 'Split PDF';
          fileInput.multiple = false;
        }
      }
      
      function resetState() {
          uploadedFiles = [];
          fileList.innerHTML = '';
          splitFileName.textContent = '';
          pageRangesInput.value = '';
          fileInput.value = '';
          actionBtn.disabled = true;
          downloadLink.classList.add('hidden');
          status.textContent = '';
      }

      // --- Event Listeners ---
      modeMergeRadio.addEventListener('change', () => updateUIForMode('merge'));
      modeSplitRadio.addEventListener('change', () => updateUIForMode('split'));
      uploadBox.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', handleFileSelect);
      actionBtn.addEventListener('click', handleAction);

      // --- File Handling & Drag-n-Drop for Merge ---
      function handleFileSelect(event) {
          const files = Array.from(event.target.files);
          if (files.length === 0) return;
          
          if (currentMode === 'merge') {
              uploadedFiles.push(...files);
              renderFileList();
          } else {
              uploadedFiles = [files[0]];
              splitFileName.textContent = `Selected: ${files[0].name}`;
          }
          actionBtn.disabled = false;
          downloadLink.classList.add('hidden');
      }

      function renderFileList() {
          fileList.innerHTML = '';
          uploadedFiles.forEach((file, index) => {
              const li = document.createElement('li');
              li.dataset.index = index;
              li.draggable = true;
              li.innerHTML = `<span class="drag-handle">â˜°</span> ${file.name}`;
              li.addEventListener('dragstart', handleDragStart);
              li.addEventListener('dragover', handleDragOver);
              li.addEventListener('drop', handleDrop);
              li.addEventListener('dragend', handleDragEnd);
              fileList.appendChild(li);
          });
      }
      
      let dragSrcElement = null;
      function handleDragStart(e) {
          dragSrcElement = this;
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', this.innerHTML);
          this.classList.add('dragging');
      }
      function handleDragOver(e) { e.preventDefault(); }
      function handleDrop(e) {
          e.stopPropagation();
          if (dragSrcElement !== this) {
              const srcIndex = parseInt(dragSrcElement.dataset.index);
              const dropIndex = parseInt(this.dataset.index);
              
              // Reorder array
              const [removed] = uploadedFiles.splice(srcIndex, 1);
              uploadedFiles.splice(dropIndex, 0, removed);
              
              renderFileList();
          }
          return false;
      }
      function handleDragEnd() {
          document.querySelectorAll('#file-list li').forEach(li => li.classList.remove('dragging'));
      }

      // --- Core Actions ---
      async function handleAction() {
        showLoading(true, 'Processing...');
        try {
          if (currentMode === 'merge') {
            await mergePdfs();
          } else {
            await splitPdf();
          }
        } catch (error) {
          console.error('Action failed:', error);
          showLoading(false, `Error: ${error.message}`);
        }
      }

      async function mergePdfs() {
          if (uploadedFiles.length < 2) {
              throw new Error('Please upload at least two PDFs to merge.');
          }

          const { PDFDocument } = window.PDFLib;
          const mergedPdf = await PDFDocument.create();
          
          for (let i = 0; i < uploadedFiles.length; i++) {
              showLoading(true, `Merging file ${i + 1} of ${uploadedFiles.length}...`);
              const file = uploadedFiles[i];
              const arrayBuffer = await file.arrayBuffer();
              const pdf = await PDFDocument.load(arrayBuffer);
              const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
              copiedPages.forEach(page => mergedPdf.addPage(page));
          }

          const pdfBytes = await mergedPdf.save();
          const blob = new Blob([pdfBytes], { type: 'application/pdf' });
          displayDownloadLink(URL.createObjectURL(blob), 'merged.pdf', 'Download Merged PDF');
      }

      async function splitPdf() {
          if (uploadedFiles.length !== 1) {
              throw new Error('Please upload a single PDF to split.');
          }
          
          const rangesStr = pageRangesInput.value.trim();
          if (!rangesStr) {
              throw new Error('Please enter the page ranges to extract.');
          }

          const { PDFDocument } = window.PDFLib;
          const { JSZip } = window;
          
          const file = uploadedFiles[0];
          const arrayBuffer = await file.arrayBuffer();
          const sourcePdf = await PDFDocument.load(arrayBuffer);
          const totalPages = sourcePdf.getPageCount();
          
          const pageIndicesToExtract = parsePageRanges(rangesStr, totalPages);
          if (pageIndicesToExtract.length === 0) {
              throw new Error('Invalid page ranges provided.');
          }
          
          const zip = new JSZip();
          const originalName = file.name.replace(/\.pdf$/i, '');

          for (let i = 0; i < pageIndicesToExtract.length; i++) {
              const indices = pageIndicesToExtract[i].indices;
              showLoading(true, `Creating PDF for range ${i + 1} of ${pageIndicesToExtract.length}...`);
              const newPdf = await PDFDocument.create();
              const copiedPages = await newPdf.copyPages(sourcePdf, indices);
              copiedPages.forEach(page => newPdf.addPage(page));
              
              const pdfBytes = await newPdf.save();
              zip.file(`${originalName}_${pageIndicesToExtract[i].name}.pdf`, pdfBytes);
          }

          showLoading(true, 'Creating ZIP file...');
          const zipBlob = await zip.generateAsync({ type: 'blob' });
          displayDownloadLink(URL.createObjectURL(zipBlob), `${originalName}_split.zip`, 'Download ZIP File');
      }
      
      function parsePageRanges(rangesStr, maxPage) {
          const ranges = [];
          const parts = rangesStr.split(',');
          for (const part of parts) {
              const trimmedPart = part.trim();
              if (trimmedPart.includes('-')) {
                  const [start, end] = trimmedPart.split('-').map(p => parseInt(p.trim()));
                  if (!isNaN(start) && !isNaN(end) && start <= end && start > 0 && end <= maxPage) {
                      const indices = [];
                      for (let i = start; i <= end; i++) indices.push(i - 1);
                      ranges.push({ name: `pages_${start}-${end}`, indices });
                  }
              } else {
                  const page = parseInt(trimmedPart);
                  if (!isNaN(page) && page > 0 && page <= maxPage) {
                      ranges.push({ name: `page_${page}`, indices: [page - 1] });
                  }
              }
          }
          return ranges;
      }
      
      // --- Utility Functions ---
      function showLoading(isLoading, message) {
          status.textContent = message;
          actionBtn.disabled = isLoading;
          if (isLoading) {
              downloadLink.classList.add('hidden');
          }
      }

      function displayDownloadLink(url, fileName, text) {
          downloadLink.href = url;
          downloadLink.download = fileName;
          downloadLink.textContent = text;
          downloadLink.classList.remove('hidden');
          showLoading(false, 'Your file is ready!');
      }
    });
  </script>
</body>
</html>
